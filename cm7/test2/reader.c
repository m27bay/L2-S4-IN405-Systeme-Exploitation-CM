// For write(), close(), read(), ...
#include <unistd.h>

// For printf(), ...
#include <stdio.h>

// For open(), ...
#include <fcntl.h>

// For strlen(), strcmp(), ...
#include <string.h>

// For perro(), errno, ...
#include <errno.h>

// For mkfifo(), wait(), ...
#include <sys/types.h>
#include <sys/stat.h>
#include <sys/wait.h>

int creat_fifo(const char *name_tube) {
  if( mkfifo(name_tube, 0666)  ==  -1 ) {
    perror("In reader.c: Error with 'mkfifo()' in 'creat_fifo()'");
    return errno;
  }
  return 0;
}

void del_tube(const char* name_tube) { unlink(name_tube); }

int main ( void ) {
  int fd , n;
  char input, message[ 26 ];

  // ouverture du tube mypipe en mode lecture
  fd = open( "mypipe", O_RDONLY);

  printf( "ici reader [%d] \n" , (int)getpid() );
  if ( fd != -1 ) {
    printf( "Recu par le lecteur :\n" );

    while ( ( n = read( fd, &input, 1 ) ) > 0 )
      printf( "%c" , input );

    printf( "Le lecteur se termine !\n" );
  }

  else
    printf( "desole , le tube n’est pas disponible\n" );

  close( fd ) ;

  message[0] = '\0';
  sprintf( message, "Bien reçu du reader [%d]\n" , (int)getpid() );
  fd = open( "mypipe2", O_WRONLY );
  if( fd != -1 )
    write( fd, message , strlen( message ) );
  else
    printf( "desole , le tube n’est pas disponible\n" );

  return 0 ;
}
